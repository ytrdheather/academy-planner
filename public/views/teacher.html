<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„ ìƒë‹˜ ëŒ€ì‹œë³´ë“œ - ë¦¬ë””íŠœë“œ</title>
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-round.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "NanumSquareRound", sans-serif; }
        body { background: #f8f9fa; color: #2d3748; min-height: 100vh; padding: 0; }
        .container { max-width: 1400px; margin: 0 auto; background: none; box-shadow: none; overflow: visible; padding: 0 20px; }
        .header { background: #ffffff; color: #6b46c1; padding: 20px 30px; text-align: left; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.8em; margin: 0; }
        .user-info { position: static; text-align: right; display: flex; align-items: center; gap: 15px;}
        .user-name { font-size: 1em; margin-bottom: 0; display: inline-block; font-weight: 600; }
        .logout-btn { background: #6b46c1; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: background 0.2s ease; box-shadow: none; }
        .logout-btn:hover { background: #5a3eaa; }
        .tab-menu { display: flex; background-color: #ffffff; border-bottom: 1px solid #e2e8f0; padding: 0 40px; margin-top: 20px; border-radius: 12px 12px 0 0; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .tab-button { padding: 15px 25px; cursor: pointer; border: none; background: none; font-size: 16px; font-weight: 600; color: #6b7280; position: relative; transition: color 0.3s ease; }
        .tab-button::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px; background-color: #8b5cf6; transform: scaleX(0); transition: transform 0.3s ease; }
        .tab-button.active { color: #6b46c1; }
        .tab-button.active::after { transform: scaleX(1); }
        .main-content { padding: 30px 0; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .stats-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; padding: 0 20px; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        .stat-value { font-size: 2.0em; font-weight: 700; color: #6b46c1; margin-bottom: 5px; }
        .stat-label { color: #718096; font-size: 14px; }
        .homework-section { background: white; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.05); border: 1px solid #e9ecef; padding: 30px; margin: 0 20px 30px; }
        .section-title { font-size: 1.6em; font-weight: 700; color: #6b46c1; margin-bottom: 25px; display: flex; align-items: center; gap: 10px; }
        .section-title::before { content: "ğŸ“‹"; font-size: 1.2em; }
        .filters-container { display:flex; gap:15px; margin-bottom:25px; align-items:center; flex-wrap: wrap; }
        .refresh-btn { background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%); color: white; border: none; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 600; }
        .filter-group { display:flex; align-items:center; gap:8px; }
        .filter-label { font-weight:600; color:#6b46c1; }
        .filter-select, .filter-input { padding:8px 12px; border-radius:8px; border:2px solid #e2e8f0; background:white; font-size: 14px; }
        #customDateContainer_hw, #customDateContainer_test { display:none; align-items:center; gap:8px; }
        #teacherFilterContainer_hw, #teacherFilterContainer_test { display:none; }
        .homework-table-container { overflow-x: auto; border: 1px solid #e9ecef; border-radius: 12px; }
        .homework-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .homework-table th { background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%); color: white; padding: 12px 10px; text-align: center; font-weight: 600; font-size: 13px; border-right: 1px solid rgba(255,255,255,0.2); white-space: nowrap; }
        .homework-table td { padding: 10px 8px; text-align: center; border-bottom: 1px solid #f1f3f4; border-right: 1px solid #f1f3f4; vertical-align: middle; font-size: 13px; }
        .homework-table tr:hover { background-color: #f8f9ff; }
        .student-name { font-weight: 600; color: #2d3748; font-size: 14px; background: #f9fafc; text-align: left; padding-left: 15px; }
        .homework-dropdown { padding: 4px 6px; border: 1px solid #e5e7eb; border-radius: 4px; font-size: 11px; font-weight: 600; text-align: center; min-width: 50px; background: white; cursor: pointer; transition: all 0.2s ease; -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%239ca3af'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1em 1em; padding-right: 1.8em; }
        .homework-dropdown:hover { border-color: #6b46c1; box-shadow: 0 0 0 2px rgba(107, 70, 193, 0.1); }
        .homework-dropdown:focus { outline: none; border-color: #6b46c1; box-shadow: 0 0 0 3px rgba(107, 70, 193, 0.1); }
        .homework-dropdown.status-complete { background-color: #dcfce7; color: #166534; border-color: #bbf7d0; }
        .homework-dropdown.status-incomplete { background-color: #fecaca; color: #991b1b; border-color: #fca5a5; }
        .homework-dropdown.status-none { background-color: #f3f4f6; color: #6b7280; border-color: #d1d5db; }
        .completion-rate { font-weight: 700; font-size: 14px; }
        .rate-excellent { color: #10b981; } .rate-good { color: #8b5cf6; } .rate-poor { color: #ef4444; }
        .refresh-rate-btn { background: none; border: none; cursor: pointer; font-size: 1.1em; vertical-align: middle; margin-left: 5px; opacity: 0.6; transition: opacity 0.2s ease, transform 0.2s ease; }
        .refresh-rate-btn:hover { opacity: 1; transform: rotate(90deg); }
        .refresh-rate-btn.loading { opacity: 0.5; cursor: default; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading, .no-data { text-align: center; padding: 60px; color: #718096; font-size: 16px; }
        .loading::before { content: "â³ "; } .no-data::before { content: "ğŸ“ "; }
        .toast-message { position: fixed; top: 20px; right: 20px; padding: 12px 20px; border-radius: 8px; font-weight: 600; z-index: 1000; opacity: 0; transform: translateX(100%); transition: all 0.3s ease; }
        .toast-message.show { opacity: 1; transform: translateX(0); }
        .toast-success { background: #dcfce7; border: 1px solid #bbf7d0; color: #166534; }
        .toast-error { background: #fecaca; border: 1px solid #fca5a5; color: #991b1b; }
        .editable-input { padding: 4px 6px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 13px; text-align: center; max-width: 60px; background-color: #f9fafb; transition: all 0.2s ease; }
        .editable-input:focus { border-color: #8b5cf6; box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2); background-color: white; }
        .editable-text-input { max-width: 100px; text-align: left; }
        .reading-result-badge { padding: 4px 10px; border-radius: 12px; font-weight: 600; font-size: 11px; display: inline-block; }
        .result-pass { background-color: #dcfce7; color: #166534; }
        .result-fail { background-color: #fecaca; color: #991b1b; }
        .result-none { background-color: #f3f4f6; color: #6b7280; }
        
        /* --- [ì¶”ê°€ë¨] ì›í˜• ì ìˆ˜ ê·¸ë˜í”„ ìŠ¤íƒ€ì¼ --- */
        .score-circle {
            position: relative;
            width: 45px; /* í¬ê¸° ì¡°ì • */
            height: 45px;
            border-radius: 50%;
            /* conic-gradient ë°°ê²½ì€ JSì—ì„œ --score-colorì™€ --score-value ë³€ìˆ˜ë¥¼ í†µí•´ ë™ì ìœ¼ë¡œ ì„¤ì •ë¨ */
            background: conic-gradient(var(--score-color, #e5e7eb) 0% var(--score-value, 0%), #e5e7eb var(--score-value, 0%) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        .score-circle::before { /* ë„ë„› êµ¬ë© */
            content: '';
            position: absolute;
            width: 75%; /* êµ¬ë© í¬ê¸° */
            height: 75%;
            background: white;
            border-radius: 50%;
        }
        .score-text {
            position: relative;
            font-size: 13px;
            font-weight: 700;
            color: var(--score-color, #6b7280);
        }
        .score-none { /* ì ìˆ˜ ì—†ì„ ë•Œ ìŠ¤íƒ€ì¼ */
            font-size: 14px;
            font-weight: 600;
            color: #9ca3af;
        }
        /* --- ê·¸ë˜í”„ ìŠ¤íƒ€ì¼ ë --- */

    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“š ë¦¬ë””íŠœë“œ ì„ ìƒë‹˜</h1>
        <div class="user-info">
            <span class="user-name" id="userName">ë¡œë”©ì¤‘...</span>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="container">
        <div class="tab-menu">
            <button class="tab-button active" onclick="showTab('homework')">ìˆ™ì œ í˜„í™©</button>
            <button class="tab-button" onclick="showTab('tests')">í…ŒìŠ¤íŠ¸ ê²°ê³¼</button>
            <button class="tab-button" onclick="showTab('reading')">ì›ì„œ ë…ì„œ í˜„í™©</button>
            <button class="tab-button" onclick="showTab('listening')">ë¦¬ìŠ¤ë‹ í˜„í™©</button>
            <button class="tab-button" onclick="showTab('comments')">ì˜¤ëŠ˜ì˜ ì½”ë©˜íŠ¸</button>
        </div>

        <div class="main-content">
            <div id="homework-view" class="tab-content active">
                 <div class="stats-summary" id="statsContainer_hw"></div>
                 <div class="homework-section">
                     <div class="section-title">ë‹´ë‹¹ í•™ìƒ ìˆ™ì œ í˜„í™©</div>
                     <div class="filters-container" id="commonFilters_hw">
                         <button class="refresh-btn" onclick="loadDataForCurrentTab()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                         <div class="filter-group">
                             <label for="periodFilter_hw" class="filter-label">ê¸°ê°„:</label>
                             <select id="periodFilter_hw" class="filter-select" onchange="toggleCustomDateInputs('hw'); loadDataForCurrentTab()">
                                 <option value="today">ì˜¤ëŠ˜</option> <option value="week">ì´ë²ˆ ì£¼</option> <option value="month">ì´ë²ˆ ë‹¬</option> <option value="custom">ì‚¬ìš©ì ì§€ì •</option>
                             </select>
                         </div>
                         <div id="customDateContainer_hw" style="display:none;" class="filter-group">
                             <input type="date" id="startDate_hw" class="filter-input" onchange="loadDataForCurrentTab()"> <span>~</span> <input type="date" id="endDate_hw" class="filter-input" onchange="loadDataForCurrentTab()">
                         </div>
                         <div id="teacherFilterContainer_hw" style="display:none;" class="filter-group">
                             <label for="teacherFilter_hw" class="filter-label">ë‹´ë‹¹ê°•ì‚¬:</label>
                             <select id="teacherFilter_hw" class="filter-select" onchange="loadDataForCurrentTab()">
                                 <option value="">ì „ì²´ ë³´ê¸°</option>
                             </select>
                         </div>
                     </div>
                     <div class="homework-table-container">
                         <table class="homework-table">
                             <thead>
                                 <tr> <th>í•™ìƒ ì´ë¦„</th> <th>ë‹´ë‹¹ê°•ì‚¬</th> <th>â­• ë¬¸ë²•</th> <th>1ï¸âƒ£ ì–´íœ˜</th> <th>2ï¸âƒ£ ë…í•´</th> <th>4ï¸âƒ£ Sum</th> <th>5ï¸âƒ£ ë…í•´</th> <th>6ï¸âƒ£ ì¼ê¸° ë“±</th> <th>ìˆ˜í–‰ìœ¨</th> </tr>
                             </thead>
                             <tbody id="homeworkTableBody">
                                 <tr><td colspan="9" class="loading">ìˆ™ì œ í˜„í™©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>
                             </tbody>
                         </table>
                     </div>
                 </div>
            </div>

            <div id="tests-view" class="tab-content">
                <div class="homework-section">
                    <div class="section-title" style="--icon:'ğŸ“'">ğŸ“ ë‹´ë‹¹ í•™ìƒ í…ŒìŠ¤íŠ¸ ê²°ê³¼</div>
                    <div class="filters-container" id="commonFilters_test">
                         <button class="refresh-btn" onclick="loadDataForCurrentTab()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                         <div class="filter-group">
                             <label for="periodFilter_test" class="filter-label">ê¸°ê°„:</label>
                             <select id="periodFilter_test" class="filter-select" onchange="toggleCustomDateInputs('test'); loadDataForCurrentTab()">
                                 <option value="today">ì˜¤ëŠ˜</option> <option value="week">ì´ë²ˆ ì£¼</option> <option value="month">ì´ë²ˆ ë‹¬</option> <option value="custom">ì‚¬ìš©ì ì§€ì •</option>
                             </select>
                         </div>
                         <div id="customDateContainer_test" style="display:none;" class="filter-group">
                             <input type="date" id="startDate_test" class="filter-input" onchange="loadDataForCurrentTab()"> <span>~</span> <input type="date" id="endDate_test" class="filter-input" onchange="loadDataForCurrentTab()">
                         </div>
                         <div id="teacherFilterContainer_test" style="display:none;" class="filter-group">
                             <label for="teacherFilter_test" class="filter-label">ë‹´ë‹¹ê°•ì‚¬:</label>
                             <select id="teacherFilter_test" class="filter-select" onchange="loadDataForCurrentTab()">
                                 <option value="">ì „ì²´ ë³´ê¸°</option>
                             </select>
                         </div>
                    </div>
                    <div class="homework-table-container">
                        <table class="homework-table">
                            <thead>
                                <tr>
                                    <th>í•™ìƒ ì´ë¦„</th>
                                    <th>ì–´íœ˜ìœ ë‹›</th>
                                    <th>ì–´íœ˜ì •ë‹µ</th>
                                    <th>ì´ê°¯ìˆ˜</th>
                                    <th>ì–´íœ˜ì ìˆ˜</th>
                                    <th>ë…í•´ì˜¤ë‹µ</th>
                                    <th>ë…í•´ê²°ê³¼</th>
                                    <th>í•˜ë¸Œë£¨íƒ€</th>
                                    <th>ë¬¸ë²•ë¬¸í•­</th> <th>ë¬¸ë²•ì˜¤ë‹µ</th> <th>ë¬¸ë²•ì ìˆ˜</th> </tr>
                            </thead>
                            <tbody id="testsTableBody">
                                <tr><td colspan="11" class="loading">í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr> </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="reading-view" class="tab-content"><div class="homework-section"><div class="section-title" style="--icon:'ğŸ“š'">ğŸ“š ì›ì„œ ë…ì„œ í˜„í™©</div><p class="no-data">êµ¬í˜„ ì˜ˆì •</p></div></div>
            <div id="listening-view" class="tab-content"><div class="homework-section"><div class="section-title" style="--icon:'ğŸ§'">ğŸ§ ë¦¬ìŠ¤ë‹ í˜„í™©</div><p class="no-data">êµ¬í˜„ ì˜ˆì •</p></div></div>
            <div id="comments-view" class="tab-content"><div class="homework-section"><div class="section-title" style="--icon:'ğŸ’¬'">ğŸ’¬ ì˜¤ëŠ˜ì˜ ì½”ë©˜íŠ¸</div><p class="no-data">êµ¬í˜„ ì˜ˆì •</p></div></div>
        </div>
    </div>

    <script>
        // --- ì „ì—­ ë³€ìˆ˜ ë° ì´ˆê¸°í™” ---
        let authToken = localStorage.getItem('teacher_auth_token');
        let allCombinedData = [];
        let currentUserRole = '';
        let currentUserName = '';
        let currentActiveTab = 'homework';

        document.addEventListener('DOMContentLoaded', () => {
            if (!authToken) { alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); window.location.href='/teacher-login'; return; }
            initializePage();
            showTab('homework'); // ì´ˆê¸° íƒ­ ì„¤ì •
        });

        async function initializePage() {
            try {
                await loadUserInfo(); // ì‚¬ìš©ì ì •ë³´ ë° ê°•ì‚¬ í•„í„° ì˜µì…˜ ë¡œë“œ
                await loadDataForCurrentTab(); // í˜„ì¬ í™œì„±í™”ëœ íƒ­ ë°ì´í„° ë¡œë“œ
            } catch (e) { console.error("ì´ˆê¸°í™” ì˜¤ë¥˜:", e); }
        }

        // --- ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ ---
        async function loadUserInfo() {
             try {
                const userInfoResponse = await fetch('/api/teacher/user-info', { headers:{Authorization:'Bearer '+authToken} });
                if (!userInfoResponse.ok) throw new Error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨');
                const data = await userInfoResponse.json();
                if (data.userName) {
                    document.getElementById('userName').textContent = data.userName + ' ('+data.userRole+')';
                    currentUserRole = data.userRole;
                    currentUserName = data.userName;
                    if (data.userRole === 'manager') {
                        // ë‘ íƒ­ì˜ í•„í„° ì»¨í…Œì´ë„ˆ ëª¨ë‘ í‘œì‹œ
                        document.getElementById('teacherFilterContainer_hw').style.display='flex';
                        document.getElementById('teacherFilterContainer_test').style.display='flex';
                        const teachersResponse = await fetch('/api/teachers', { headers:{Authorization:'Bearer '+authToken} });
                        if (!teachersResponse.ok) throw new Error('ê°•ì‚¬ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨');
                        const teachers = await teachersResponse.json();
                        updateTeacherFilterOptions(teachers); // ë‘ í•„í„° ëª¨ë‘ ì—…ë°ì´íŠ¸
                    } else {
                         // ë§¤ë‹ˆì €ê°€ ì•„ë‹ ë•Œ, í•„í„° ìˆ¨ê¹€
                         document.getElementById('teacherFilterContainer_hw').style.display='none';
                         document.getElementById('teacherFilterContainer_test').style.display='none';
                    }
                } else { throw new Error('ì‚¬ìš©ì ì •ë³´ í˜•ì‹ì´ ì˜ëª»ë¨'); }
            } catch (error) {
                 console.error("ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:", error);
                 alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                 logout();
            }
        }

        async function loadDataForCurrentTab() {
            // í˜„ì¬ í™œì„±í™”ëœ íƒ­ì— ë”°ë¼ ë°ì´í„° ë¡œë“œ
            if (currentActiveTab === 'homework' || currentActiveTab === 'tests') {
                await loadHomeworkAndTestData();
            }
            // ... ë‹¤ë¥¸ íƒ­ ë°ì´í„° ë¡œë“œ ...
        }

        async function loadHomeworkAndTestData() {
            const hwTbody = document.getElementById('homeworkTableBody');
            const testTbody = document.getElementById('testsTableBody');
            hwTbody.innerHTML = '<tr><td colspan="9" class="loading">ë¡œë”©ì¤‘...</td></tr>';
            testTbody.innerHTML = '<tr><td colspan="11" class="loading">ë¡œë”©ì¤‘...</td></tr>';

            // í™œì„±í™”ëœ íƒ­ì˜ í•„í„° ê°’ ì‚¬ìš©
            const filterSuffix = (currentActiveTab === 'tests') ? '_test' : '_hw';
            const period = document.getElementById(`periodFilter${filterSuffix}`).value;
            const teacherSelect = document.getElementById(`teacherFilter${filterSuffix}`);
            // ì„ ìƒë‹˜ ì—­í• ì¼ ê²½ìš°, í•„í„° ê°’ì„ ìì‹ ì˜ ì´ë¦„ìœ¼ë¡œ, ë§¤ë‹ˆì €ë©´ ì„ íƒëœ ê°’ìœ¼ë¡œ
            const teacher = (currentUserRole === 'manager' && teacherSelect) ? teacherSelect.value : (currentUserRole === 'teacher' ? currentUserName : '');

            try {
                let url = `/api/homework-status?period=${period}`;
                if (period === 'custom') {
                    const s = document.getElementById(`startDate${filterSuffix}`).value, e = document.getElementById(`endDate${filterSuffix}`).value;
                    if (s && e) url += `&startDate=${s}&endDate=${e}`;
                    else { throw new Error('ì‚¬ìš©ì ì§€ì • ê¸°ê°„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'); }
                }
                 // ë§¤ë‹ˆì €ì´ê³  'ì „ì²´ ë³´ê¸°'ê°€ ì•„ë‹ ë•Œë§Œ teacher íŒŒë¼ë¯¸í„° ì¶”ê°€
                 if (currentUserRole === 'manager' && teacher && teacher !== "") {
                     url += `&teacher=${encodeURIComponent(teacher)}`;
                 }
                 // ì„ ìƒë‹˜ ì—­í• ì¼ ê²½ìš°, ì„œë²„ì—ì„œ req.user.nameìœ¼ë¡œ ìë™ í•„í„°ë§ (index.js ë¡œì§)

                const response = await fetch(url, { headers:{Authorization:'Bearer '+authToken} });
                if (!response.ok) { 
                    const errorText = await response.text(); 
                    console.error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜:", errorText); 
                    throw new Error("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨"); 
                }
                const combinedData = await response.json();
                allCombinedData = combinedData;

                displayHomeworkData(combinedData);
                displayTestData(combinedData);
                updateStats(combinedData, period === 'today'); // 'ì˜¤ëŠ˜'ì¸ ê²½ìš°ë§Œ ì˜¤ëŠ˜ í†µê³„
            } catch(e) {
                console.error("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", e);
                const errorMsg = `<tr><td colspan="${(currentActiveTab === 'tests') ? 11 : 9}" class="no-data">${e.message || 'ë¡œë“œ ì‹¤íŒ¨'}</td></tr>`;
                hwTbody.innerHTML = errorMsg;
                testTbody.innerHTML = errorMsg;
                updateStats([]);
            }
        }

        // --- UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function toggleCustomDateInputs(suffix) {
             const period = document.getElementById(`periodFilter_${suffix}`).value;
             document.getElementById(`customDateContainer_${suffix}`).style.display = (period === 'custom') ? 'flex' : 'none';
        }

        function displayHomeworkData(data) {
            const tbody = document.getElementById('homeworkTableBody');
            if (!data || !data.length) { tbody.innerHTML = '<tr><td colspan="9" class="no-data">ë°ì´í„° ì—†ìŒ</td></tr>'; return; }
            tbody.innerHTML = data.map(st => `
                <tr id="row-hw-${st.pageId || Math.random()}">
                    <td class="student-name">${st.studentName || 'ì´ë¦„ ì—†ìŒ'}</td>
                    <td>${(st.teachers || []).join(', ') || 'ë¯¸ë°°ì •'}</td>
                    <td>${formatHomeworkDropdown(st.pageId, 'â­• ì§€ë‚œ ë¬¸ë²• ìˆ™ì œ ê²€ì‚¬', st.grammarHomework)}</td>
                    <td>${formatHomeworkDropdown(st.pageId, '1ï¸âƒ£ ì–´íœ˜ í´ì¹´ ì•”ê¸° ìˆ™ì œ', st.vocabCards)}</td>
                    <td>${formatHomeworkDropdown(st.pageId, '2ï¸âƒ£ ë…í•´ ë‹¨ì–´ í´ì¹´ ìˆ™ì œ', st.readingCards)}</td>
                    <td>${formatHomeworkDropdown(st.pageId, '4ï¸âƒ£ Summary ìˆ™ì œ', st.summary)}</td>
                    <td>${formatHomeworkDropdown(st.pageId, '5ï¸âƒ£ ë§¤ì¼ ë…í•´ ìˆ™ì œ', st.readingHomework)}</td>
                    <td>${formatHomeworkDropdown(st.pageId, '6ï¸âƒ£ ì˜ì–´ì¼ê¸° or ê°œì¸ ë…í•´ì„œ', st.diary)}</td>
                    <td>
                        <span class="completion-rate ${rateClass(st.completionRate)}">${st.completionRate || 0}%</span>
                        <button class="refresh-rate-btn" onclick="refreshStudentRate(this, '${st.pageId}')" title="ìˆ˜í–‰ìœ¨ ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
                    </td>
                </tr>`).join('');
        }

        // [ìˆ˜ì •ë¨] í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë°ì´í„° í‘œì‹œ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì ìˆ˜ ê³„ì‚°)
        function displayTestData(data) {
            const tbody = document.getElementById('testsTableBody');
            if (!data || !data.length) { tbody.innerHTML = '<tr><td colspan="11" class="no-data">ë°ì´í„° ì—†ìŒ</td></tr>'; return; }
            tbody.innerHTML = data.map(st => {
                // ì–´íœ˜ ì ìˆ˜ ê³„ì‚°
                const vScore = (st.vocabTotal > 0) ? Math.round((st.vocabCorrect / st.vocabTotal) * 100) : 0;
                // ë¬¸ë²• ì ìˆ˜ ê³„ì‚°
                const gScore = (st.grammarTotal > 0) ? Math.round(((st.grammarTotal - (st.grammarWrong || 0)) / st.grammarTotal) * 100) : 0;
                
                return `
                <tr id="row-test-${st.pageId || Math.random()}">
                    <td class="student-name">${st.studentName || 'ì´ë¦„ ì—†ìŒ'}</td>
                    <td><input type="text" class="editable-input editable-text-input" value="${st.vocabUnit || ''}" defaultValue="${st.vocabUnit || ''}" data-page-id="${st.pageId || ''}" data-property-name="ì–´íœ˜ìœ ë‹›" data-property-type="rich_text" onblur="updateField(this)" onkeydown="handleEnterAsTab(event)"></td>
                    <td><input type="number" class="editable-input" value="${st.vocabCorrect ?? ''}" defaultValue="${st.vocabCorrect ?? ''}" data-page-id="${st.pageId || ''}" data-property-name="ë‹¨ì–´ (ë§ì€ ê°œìˆ˜)" data-property-type="number" onchange="updateField(this)" onkeydown="handleEnterAsTab(event)"></td>
                    <td><input type="number" class="editable-input" value="${st.vocabTotal ?? ''}" defaultValue="${st.vocabTotal ?? ''}" data-page-id="${st.pageId || ''}" data-property-name="ë‹¨ì–´ (ì „ì²´ ê°œìˆ˜)" data-property-type="number" onchange="updateField(this)" onkeydown="handleEnterAsTab(event)"></td>
                    <td>${formatScoreCircle(vScore)}</td> <td><input type="number" class="editable-input" value="${st.readingWrong ?? ''}" defaultValue="${st.readingWrong ?? ''}" data-page-id="${st.pageId || ''}" data-property-name="ë…í•´ (í‹€ë¦° ê°œìˆ˜)" data-property-type="number" onchange="updateField(this)" onkeydown="handleEnterAsTab(event)"></td>
                    <td><span class="reading-result-badge ${getReadingResultClass(st.readingResult)}">${st.readingResult || '-'}</span></td>
                    <td>${formatSelectDropdown(st.pageId, 'ë…í•´ í•˜ë¸Œë£¨íƒ€', st.havruta, ['ì™„ë£Œí•¨', 'ëª»í•˜ê³ ê°', 'ìˆ™ì œì—†ìŒ'])}</td>
                    <td><input type="number" class="editable-input" value="${st.grammarTotal ?? ''}" defaultValue="${st.grammarTotal ?? ''}" data-page-id="${st.pageId || ''}" data-property-name="ë¬¸ë²• (ì „ì²´ ê°œìˆ˜)" data-property-type="number" onchange="updateField(this)" onkeydown="handleEnterAsTab(event)"></td>
                    <td><input type="number" class="editable-input" value="${st.grammarWrong ?? ''}" defaultValue="${st.grammarWrong ?? ''}" data-page-id="${st.pageId || ''}" data-property-name="ë¬¸ë²• (í‹€ë¦° ê°œìˆ˜)" data-property-type="number" onchange="updateField(this)" onkeydown="handleEnterAsTab(event)"></td>
                    <td>${formatScoreCircle(gScore)}</td> </tr>`
            }).join('');
        }
        
        // [ìƒˆ í•¨ìˆ˜] Enter í‚¤ë¥¼ Tabì²˜ëŸ¼ ì‚¬ìš©
        function handleEnterAsTab(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // ê¸°ë³¸ Enter ë™ì‘ ë°©ì§€
                const formElements = Array.from(document.querySelectorAll('#testsTableBody input, #testsTableBody select'));
                const currentIndex = formElements.indexOf(event.target);
                const nextElement = formElements[currentIndex + 1];
                if (nextElement) {
                    nextElement.focus();
                    if (nextElement.select) nextElement.select(); // input text/numberì˜ ê²½ìš° í…ìŠ¤íŠ¸ ì „ì²´ ì„ íƒ
                } else {
                    event.target.blur(); // ë‹¤ìŒ ìš”ì†Œê°€ ì—†ìœ¼ë©´ í¬ì»¤ìŠ¤ í•´ì œ
                }
            }
        }

        // --- Helper Functions (Styling & Formatting) ---
        function getReadingResultClass(result) { if (result === 'PASS') return 'result-pass'; if (result === 'FAIL') return 'result-fail'; return 'result-none'; }
        
        function formatSelectDropdown(pageId, propertyName, currentValue, options) {
            const defaultOption = 'ìˆ™ì œì—†ìŒ';
            const displayValue = options.includes(currentValue) ? currentValue : defaultOption;
            return `<select class="homework-dropdown" data-page-id="${pageId || ''}" data-property-name="${propertyName}" data-property-type="select" onchange="updateField(this)">
                        ${options.map(option => `<option value="${option}" ${option === displayValue ? 'selected' : ''}>${option}</option>`).join('')}
                    </select>`;
        }
        
        function formatHomeworkDropdown(pageId, propertyName, currentStatus) {
            const options = ['ìˆ™ì œ í•¨', 'ì•ˆ í•´ì˜´', 'ìˆ™ì œ ì—†ìŒ'];
            const statusClass = getHomeworkStatusClass(currentStatus);
            const displayStatus = options.includes(currentStatus) ? currentStatus : 'ìˆ™ì œ ì—†ìŒ';
            return `<select class="homework-dropdown ${statusClass}" data-page-id="${pageId || ''}" data-property-name="${propertyName}" data-property-type="status" onchange="updateField(this)">
                        ${options.map(option => `<option value="${option}" ${option === displayStatus ? 'selected' : ''}>${option}</option>`).join('')}
                    </select>`;
        }
        
        function getHomeworkStatusClass(status) { if (status === 'ìˆ™ì œ í•¨') return 'status-complete'; if (status === 'ì•ˆ í•´ì˜´') return 'status-incomplete'; return 'status-none'; }
        
        function rateClass(r){ if(r>=90)return'rate-excellent'; if(r>=70)return'rate-good'; return'rate-poor'; }

        // [ìˆ˜ì •ë¨] ì ìˆ˜(ìˆ«ì)ë¥¼ ë°›ì•„ ìŠ¤íƒ€ì¼ ë°˜í™˜
        function getScoreStyle(score) {
            let color = '#ef4444'; // 40ì  ë¯¸ë§Œ (ë¹¨ê°•)
            if (score >= 80) color = '#10b981'; // 80ì  ì´ìƒ (ì´ˆë¡)
            else if (score >= 60) color = '#f59e0b'; // 60ì  ì´ìƒ (ì£¼í™©)
            else if (score >= 40) color = '#facc15'; // 40ì  ì´ìƒ (ë…¸ë‘)
            return `style="--score-color: ${color}; --score-value: ${score}%"`;
        }

        // [ìˆ˜ì •ë¨] ì ìˆ˜(ìˆ«ì)ë¥¼ ë°›ì•„ ê·¸ë˜í”„ HTML ë°˜í™˜
        function formatScoreCircle(score) {
            if (score === null || isNaN(score) || score === 0) return '<span class="score-none">-</span>'; // 0ì ì´ë‚˜ nullì´ë©´ - í‘œì‹œ
            const style = getScoreStyle(score);
            return `
                <div class="score-circle" ${style}>
                    <span class="score-text">${Math.round(score)}%</span>
                </div>
            `;
        }

        async function refreshStudentRate(buttonElement, pageId) {
             if (!pageId) { showToast('í˜ì´ì§€ IDê°€ ì—†ì–´ ìƒˆë¡œê³ ì¹¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error'); return; }
             console.log(`ê°œë³„ ìƒˆë¡œê³ ì¹¨ ìš”ì²­: ${pageId}`);
             buttonElement.classList.add('loading'); buttonElement.disabled = true;
             try {
                 const response = await fetch(`/api/student-homework/${pageId}`, { headers: { 'Authorization': 'Bearer ' + authToken } });
                 if (!response.ok) { throw new Error('ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨'); }
                 const result = await response.json();
                 if (result.success) {
                     const row = buttonElement.closest('tr');
                     if (row) {
                        const rateSpan = row.querySelector('.completion-rate');
                        if (rateSpan) {
                             rateSpan.textContent = `${result.completionRate || 0}%`;
                             rateSpan.className = `completion-rate ${rateClass(result.completionRate)}`;
                             showToast(`${result.studentName} í•™ìƒ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ`, 'success');
                        }
                     }
                 } else { throw new Error(result.message || 'ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨'); }
             } catch (error) {
                 console.error('ê°œë³„ í•™ìƒ ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
                 showToast(`ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨: ${error.message}`, 'error');
             } finally {
                 buttonElement.classList.remove('loading'); buttonElement.disabled = false;
             }
        }

        function updateStats(data){
             const container = document.getElementById('statsContainer_hw');
             if (!container) return;
             if(!data || !data.length){ container.innerHTML = `<div class="stat-card"><div class="stat-value">0</div><div class="stat-label">ì´ í•™ìƒ ìˆ˜</div></div><div class="stat-card"><div class="stat-value">0%</div><div class="stat-label">í‰ê·  ìˆ˜í–‰ìœ¨</div></div><div class="stat-card"><div class="stat-value">0</div><div class="stat-label">ìš°ìˆ˜ í•™ìƒ</div></div>`; return; }
             
             // 'ì˜¤ëŠ˜' ë°ì´í„°ë§Œ í•„í„°ë§ (í†µê³„ìš©)
             const today = new Date(new Date().getTime() - (new Date().getTimezoneOffset() * 60000)).toISOString().split('T')[0];
             const todayData = data.filter(item => item.date === today);

             const uniqueStudents = new Set(todayData.map(item => item.studentName));
             const totalStudents = uniqueStudents.size;
             const avg = todayData.length > 0 ? Math.round(todayData.reduce((s,x)=>s+(x.completionRate||0),0)/todayData.length) : 0;
             const excellentStudents = new Set(todayData.filter(x => (x.completionRate || 0) === 100).map(item => item.studentName)).size;

             container.innerHTML=`<div class="stat-card"><div class="stat-value">${totalStudents}</div><div class="stat-label">ì´ í•™ìƒ ìˆ˜ (ì˜¤ëŠ˜)</div></div><div class="stat-card"><div class="stat-value">${avg}%</div><div class="stat-label">í‰ê·  ìˆ˜í–‰ìœ¨ (ì˜¤ëŠ˜)</div></div><div class="stat-card"><div class="stat-value">${excellentStudents}</div><div class="stat-label">ìš°ìˆ˜ í•™ìƒ (100%)</div></div>`;
        }

        function updateTeacherFilterOptions(teachers){
             const selHw = document.getElementById('teacherFilter_hw');
             const selTest = document.getElementById('teacherFilter_test');
             if (!selHw || !selTest) return;
             while(selHw.children.length > 1) selHw.removeChild(selHw.lastChild);
             while(selTest.children.length > 1) selTest.removeChild(selTest.lastChild);
             teachers.forEach(t=>{
                 const o = document.createElement('option'); o.value=t.name; o.textContent=t.name;
                 selHw.appendChild(o.cloneNode(true));
                 selTest.appendChild(o);
             });
             if (currentUserRole !== 'manager') {
                 selHw.value = currentUserName; selHw.disabled = true;
                 selTest.value = currentUserName; selTest.disabled = true;
             } else {
                 selHw.disabled = false; selTest.disabled = false;
             }
        }

        // [ìˆ˜ì •ë¨] ë²”ìš© í•„ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateField(element) {
            const pageId = element.getAttribute('data-page-id');
            const propertyName = element.getAttribute('data-property-name');
            const propertyType = element.getAttribute('data-property-type');
            let newValue = element.value;
            const tagName = element.tagName.toUpperCase();
            let originalValue;

            if (tagName === 'INPUT') { // input (text, number)
                originalValue = element.defaultValue;
                if (propertyType === 'number') {
                    newValue = (newValue === '') ? null : Number(newValue);
                    if (newValue !== null && isNaN(newValue)) { showToast('ìœ íš¨í•œ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error'); element.value = originalValue || ''; return; }
                }
            } else { // SELECT
                originalValue = Array.from(element.options).find(opt => opt.defaultSelected)?.value || element.options[0].value;
            }

            if (!pageId || !propertyName) { showToast('ì—…ë°ì´íŠ¸ ì •ë³´ ë¶€ì¡±', 'error'); return; }

            console.log('í•„ë“œ ì—…ë°ì´íŠ¸ ìš”ì²­:', { pageId, propertyName, newValue, propertyType });
            element.disabled = true; element.style.opacity = '0.6';

            try {
                const response = await fetch('/api/update-homework', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + authToken },
                    body: JSON.stringify({ pageId, propertyName, newValue, propertyType })
                });
                if (!response.ok) {
                    if (response.status === 401) { alert('ë¡œê·¸ì¸ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); logout(); return; }
                    const errorData = await response.json(); throw new Error(errorData.message || 'ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                }
                const result = await response.json();
                showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('í•„ë“œ ì—…ë°ì´íŠ¸ ì„±ê³µ:', result);

                 if (tagName === 'INPUT') {
                     element.defaultValue = element.value; // inputì˜ ê¸°ë³¸ê°’ ì—…ë°ì´íŠ¸
                 }
                 if (tagName === 'SELECT') {
                    // selectì˜ ê¸°ë³¸ selected ì†ì„± ì—…ë°ì´íŠ¸
                    Array.from(element.options).forEach(opt => opt.defaultSelected = false);
                    const newSelectedOption = element.querySelector(`option[value="${newValue}"]`);
                    if(newSelectedOption) newSelectedOption.defaultSelected = true;
                    if (propertyType === 'status') {
                         element.className = `homework-dropdown ${getHomeworkStatusClass(newValue)}`;
                    }
                 }
                 
                 // [ìˆ˜ì •] ì ìˆ˜ ë³€ê²½ ì‹œ, í•´ë‹¹ í–‰ì˜ ì ìˆ˜ ê·¸ë˜í”„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                 const row = element.closest('tr');
                 if (row && (propertyName === 'ë‹¨ì–´ (ë§ì€ ê°œìˆ˜)' || propertyName === 'ë‹¨ì–´ (ì „ì²´ ê°œìˆ˜)')) {
                     const correct = Number(row.querySelector('[data-property-name="ë‹¨ì–´ (ë§ì€ ê°œìˆ˜)"]').value);
                     const total = Number(row.querySelector('[data-property-name="ë‹¨ì–´ (ì „ì²´ ê°œìˆ˜)"]').value);
                     const newScore = (total > 0) ? Math.round((correct / total) * 100) : 0;
                     row.querySelector('.vocab-score').innerHTML = formatScoreCircle(newScore);
                 }
                 if (row && (propertyName === 'ë¬¸ë²• (ì „ì²´ ê°œìˆ˜)' || propertyName === 'ë¬¸ë²• (í‹€ë¦° ê°œìˆ˜)')) {
                     const total = Number(row.querySelector('[data-property-name="ë¬¸ë²• (ì „ì²´ ê°œìˆ˜)"]').value);
                     const wrong = Number(row.querySelector('[data-property-name="ë¬¸ë²• (í‹€ë¦° ê°œìˆ˜)"]').value);
                     const newScore = (total > 0) ? Math.round(((total - wrong) / total) * 100) : 0;
                     row.querySelector('td:last-child').innerHTML = formatScoreCircle(newScore); // ë¬¸ë²• ì ìˆ˜ëŠ” ë§ˆì§€ë§‰ ì…€
                 }

                 // ìˆ˜í–‰ìœ¨ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì´ ìˆë‹¤ë©´ ì¦‰ì‹œ í˜¸ì¶œ
                 const refreshButton = row?.querySelector('.refresh-rate-btn');
                 if (refreshButton) {
                     refreshStudentRate(refreshButton, pageId);
                 }

            } catch (error) {
                console.error('í•„ë“œ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                element.value = originalValue || ''; // ì‹¤íŒ¨ ì‹œ ì›ë˜ ê°’ìœ¼ë¡œ ë³µêµ¬
                if (tagName === 'SELECT' && propertyType === 'status') element.className = `homework-dropdown ${getHomeworkStatusClass(originalValue)}`;
                showToast(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            } finally {
                element.disabled = false; element.style.opacity = '1';
            }
        }

        function showToast(message, type = 'success') {
             const existingToast = document.querySelector('.toast-message');
             if (existingToast) existingToast.remove();
             const toast = document.createElement('div');
             toast.className = `toast-message toast-${type}`;
             toast.textContent = message;
             document.body.appendChild(toast);
             setTimeout(() => { toast.classList.add('show'); }, 100);
             setTimeout(() => {
                 toast.classList.remove('show');
                 setTimeout(() => { if (toast.parentNode) toast.parentNode.removeChild(toast); }, 300);
             }, 3000);
        }

        // í•„í„° ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ê° íƒ­ í•„í„°ì— ë§ê²Œ ìˆ˜ì •)
        ['hw', 'test'].forEach(suffix => {
            const teacherFilter = document.getElementById(`teacherFilter_${suffix}`);
            if(teacherFilter) teacherFilter.addEventListener('change', loadDataForCurrentTab);
            
            const periodFilter = document.getElementById(`periodFilter_${suffix}`);
            if(periodFilter) periodFilter.addEventListener('change', loadDataForCurrentTab);
            
            const startDate = document.getElementById(`startDate_${suffix}`);
            if(startDate) startDate.addEventListener('change', loadDataForCurrentTab);
            
            const endDate = document.getElementById(`endDate_${suffix}`);
            if(endDate) endDate.addEventListener('change', loadDataForCurrentTab);
        });

        function logout(){ localStorage.removeItem('teacher_auth_token'); alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤."); window.location.href='/teacher-login'; }
        
        function checkTokenExpiry() {
             const token = localStorage.getItem('teacher_auth_token');
             if (!token) { window.location.href = '/teacher-login'; return; }
             try {
                 const payload = JSON.parse(atob(token.split('.')[1]));
                 const now = Date.now() / 1000;
                 if (payload.exp < now) { alert('ë¡œê·¸ì¸ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); logout(); }
             } catch (error) { console.error('í† í° ê²€ì¦ ì˜¤ë¥˜:', error); logout(); }
        }
        setInterval(checkTokenExpiry, 5 * 60 * 1000);

        // --- íƒ­ ì „í™˜ í•¨ìˆ˜ ---
        function showTab(tabName) {
            currentActiveTab = tabName;
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            const selectedContent = document.getElementById(tabName + '-view');
            if (selectedContent) selectedContent.classList.add('active');
            const selectedButton = document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`);
            if (selectedButton) selectedButton.classList.add('active');
            
            syncFilters(tabName);
            loadDataForCurrentTab();
        }

        function syncFilters(targetTabName) {
            const targetSuffix = (targetTabName === 'tests') ? '_test' : '_hw';
            const sourceSuffix = (targetTabName === 'tests') ? '_hw' : '_test';

            const period = document.getElementById(`periodFilter${sourceSuffix}`)?.value;
            if(period) document.getElementById(`periodFilter${targetSuffix}`).value = period;
            const start = document.getElementById(`startDate${sourceSuffix}`)?.value;
            if(start) document.getElementById(`startDate${targetSuffix}`).value = start;
            const end = document.getElementById(`endDate${sourceSuffix}`)?.value;
            if(end) document.getElementById(`endDate${targetSuffix}`).value = end;
            const teacher = document.getElementById(`teacherFilter${sourceSuffix}`)?.value;
            if(teacher) document.getElementById(`teacherFilter${targetSuffix}`).value = teacher;
            
            toggleCustomDateInputs(targetSuffix);
        }
    </script>
</body>
</html>